from flask import Flask, render_template, request, send_file
from docx import Document

app = Flask(__name__)

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/generate_docx', methods=['POST'])
def gerar_docx():
    nome = request.form['nome']

    doc = Document('modelo.docx')  # Substitua 'modelo.docx' pelo caminho do seu modelo DOCX

    # para paragrafo
    #for paragraph in doc.paragraphs:
    #    if '{{nome}}' in paragraph.text:
    #        paragraph.text = paragraph.text.replace('{{nome}}', nome)

    for table in doc.tables: #percorrendo todas as tabelas
        for row in table.rows: #percorrendo todas as linhas
            for cell in row.cells: #percorrendo todas as cedulas 
                cell_text = cell.text 
                if '{{nome}}' in cell_text: #se encontrar {{NOME}}
                    cell.text = cell_text.replace('{{nome}}', nome) #vai inserir o valor do usuario

    doc.save(f'{nome}.docx') #salvo o arquivo

    return send_file(f'{nome}.docx', as_attachment=True)

if __name__ == '__main__':
    app.run(debug=True)
